version: "3"

services:
  photoview-app:
    image: viktorstrate/photoview:2
    container_name: photoview
    hostname: photoview
    restart: unless-stopped
    ports:
      - "8000:80"
    depends_on:
      - photoview-db
    environment:
      - PHOTOVIEW_DATABASE_DRIVER=mysql
      - PHOTOVIEW_MYSQL_URL=$mysql_user:$mysql_password@tcp(photoview-db)/photoview
      - PHOTOVIEW_LISTEN_IP=photoview
      - PHOTOVIEW_LISTEN_PORT=80
      - PHOTOVIEW_MEDIA_CACHE=/app/cache
      - MAPBOX_TOKEN=$mapbox_token
    volumes:
      - ./cache:/app/cache
      - /home/antsva/docker/nextcloud/data/antsva/files/Bilder:/photos:ro
  photoview-db:
    image: mariadb:10.5
    container_name: photoview-db
    restart: always
    environment:
      - MYSQL_DATABASE=photoview
      - MYSQL_USER=$mysql_user
      - MYSQL_PASSWORD=$mysql_password
      - MYSQL_RANDOM_ROOT_PASSWORD=1
    volumes:
      - ./db:/var/lib/mysql

